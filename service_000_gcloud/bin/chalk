#! /bin/sh

# set -x
# set -euo pipefail

source ~/.profile

if [ -z "$CHALK_STATUS" ]
    then 
        SCRIPTS_DEFAULT_PATH=/usr/src/service_000_gcloud/scripts/shell
        PROFILE_FILE=$HOME/.profile
        LIB_RESOURCES="UTILS_LIB=/usr/src/service_000_gcloud/scripts/shell/chalk/lib
        source \$UTILS_LIB/env.sh
        source \$UTILS_LIB/utils.sh
        source \$UTILS_LIB/prompts.sh
        "

        printf "%s" "$LIB_RESOURCES" >> "$PROFILE_FILE"
        sleep 10

        chalk "$@"
        return 1 
fi

if [ -z $1 ] || [ $1 = "help" ]
    then 
        shift
        . ${SCRIPTS:-$SCRIPTS_DEFAULT_PATH}/chalk/config/help.sh "$@"
        return 1
    else

        # handle gcloud commands
        if [ $1 = "gcloud" ]
            then 
                shift
                . "$SCRIPTS"/chalk/config/gcloud.sh "$@"
                return 1
        fi

        # handle install / uninstall of services and resources
        if [ $1 = "install" ] || [ $1 = "uninstall" ] || [ $1 = "upgrade" ]
            then 
                SETUP_ACTION=$1
                shift
                . "$SCRIPTS"/chalk/config/setup.sh "$@" "$SETUP_ACTION"
                return 1
        fi

        # handle error commands
        if [ $1 = "error" ] || [ $1 = "errors" ]
            then 
                shift
                . "$SCRIPTS"/chalk/config/errors.sh "$@"
                return 1
        fi

        # catch all errors
        . "$SCRIPTS"/chalk/config/errors.sh "$@"
        exit 1
fi
